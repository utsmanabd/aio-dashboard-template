<div class="mt-2">
    <h2 class="text-primary">Checklist Activity</h2>
    <span *ngIf="machineAreaData === undefined; else content" class="d-flex align-items-center mt-3">
        <span class="spinner-border flex-shrink-0" role="status">
            <span class="visually-hidden">Loading...</span>
        </span>
        <span class="flex-grow-1 ms-2">
            Loading...
        </span>
    </span>
    <ng-template #content>
        <form class="mt-3">
            <div class="mb-2">
                <label for="machineAreaSelect">Select machine area</label>
                <select name="machineAreaSelect" [(ngModel)]="selectedMachineArea" id="machineAreaSelect"
                    class="form-select mb-3" aria-label="Machine Area Select">
                    <option *ngFor="let data of machineAreaData" value="{{ data.m_area_id }}">{{ data.machine_area }}
                    </option>
                </select>
            </div>
            <button *ngIf="!isLoading; else loadingButton" class="btn btn-success" (click)="onSelectedMachineArea()">OK</button>
        </form>
    </ng-template>
    <ng-template #loadingButton>
        <button type="button" class="btn btn-success btn-load me-2" disabled>
            <span class="d-flex align-items-center">
                <span class="spinner-border flex-shrink-0" role="status">
                    <span class="visually-hidden">Loading...</span>
                </span>
                <span class="flex-grow-1 ms-2">
                    Loading...
                </span>
            </span>
        </button>
    </ng-template>
    <div class="mt-3" *ngIf="identityTaskData && identityTaskCountData !== undefined">
        <h5>Machine Area: <span class="text-danger">{{ identityTaskCountData.machine_area }}</span></h5>
        <p><span class="text-primary">{{ common.getDate(identityTaskCountData.date) }}</span></p>
        <p>Completed:
            <span class="text-secondary">
                {{ common.getTaskPercentage(identityTaskCountData.total_activity, identityTaskCountData.checklist) }}%
            </span>
        </p>
        <div class="progress animated-progress mb-2" style="background-color: white;">
            <div class="progress-bar bg-secondary" role="progressbar"
                attr.style="width: {{common.getTaskPercentage(identityTaskCountData.total_activity, identityTaskCountData.checklist)}}%"
                [attr.aria-valuenow]="common.getTaskPercentage(identityTaskCountData.total_activity, identityTaskCountData.checklist)"
                aria-valuemin="0" aria-valuemax="100">{{ common.getTaskPercentage(identityTaskCountData.total_activity,
                identityTaskCountData.checklist) }}%</div>
        </div>
        <input type="text" class="form-control mb-2" placeholder="Search for activity, standard, etc." [(ngModel)]="searchKeyword">
        <div class="card table-responsive">
            <table class="table align-middle mb-0">
                <thead class="table-light">
                    <tr>
                        <th *ngFor="let col of tableColumns" scope="col">{{ col }}</th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let data of filterIdentityTaskData(); let i = index" [ngSwitch]="data.category">
                        <td>{{ common.getComputedRowNumber(index, i) }}</td>
                        <td>{{ data.activity }}</td>
                        <td>{{ data.periode }}</td>
                        <td *ngSwitchCase="'Cleaning'">
                            <span class="badge bg-primary">
                                {{ data.category }}
                            </span>
                        </td>
                        <td *ngSwitchCase="'Inspecting'">
                            <span class="badge bg-secondary">
                                {{ data.category }}
                            </span>
                        </td>
                        <td *ngSwitchCase="'Lubricating'">
                            <span class="badge bg-info">
                                {{ data.category }}
                            </span>
                        </td>
                        <td *ngSwitchCase="'Tightening'">
                            <span class="badge bg-success">
                                {{ data.category }}
                            </span>
                        </td>
                        <td><i>{{ data.standard }}</i></td>
                        <td>
                            <!-- {{ data.condition }} -->
                            <div class="form-check form-radio-info mb-2">
                                <input class="form-check-input" type="radio"
                                    name="flexRadioCondition{{data.task_activity_id}}"
                                    [checked]="isConditionOk(data.condition)" value="1"
                                    (change)="changeCondition($event, data.task_activity_id)" id="flexRadioOK{{data.task_activity_id}}">
                                <label class="form-check-label ms-1"
                                    for="flexRadioOK{{data.task_activity_id}}">Ok</label>
                            </div>

                            <div class="form-check form-radio-info">
                                <input class="form-check-input" type="radio"
                                    [checked]="isConditionNotOk(data.condition)" value="0"
                                    (change)="changeCondition($event, data.task_activity_id)"
                                    name="flexRadioCondition{{data.task_activity_id}}"
                                    id="flexRadioNotOK{{data.task_activity_id}}">
                                <label class="form-check-label ms-1" for="flexRadioNotOK{{data.task_activity_id}}">
                                    Not Ok</label>
                            </div>
                        </td>
                        <td>
                            <div>
                                <input [(ngModel)]="data.comment" id="comment{{data.task_activity_id}}"
                                    class="form-control" placeholder="Enter comment"
                                    name="comment{{ data.task_activity_id}}" />
                            </div>

                        </td>
                        <td>
                            <img *ngIf="data.picture" [src]="getImageSource(data.picture)" alt="activity_picture" style="width: 150px;" >
                            <div *ngIf="!data.picture">
                                <input class="form-control form-control-sm" id="picture{{data.task_activity_id}}"
                                    type="file" (change)="onImageSelected($event, data.task_activity_id)">
                            </div>
                        </td>
                        <td>
                            <div>
                                <input [(ngModel)]="data.pic" id="pic{{data.task_activity_id}}" class="form-control"
                                    placeholder="Enter name" name="pic{{ data.task_activity_id}}" />
                            </div>

                        </td>
                    </tr>
                </tbody>
            </table>
            <!-- end table -->
        </div>
        <div class="d-flex justify-content-center mb-3">
            <button *ngIf="!isLoading; else loadingButton" class="btn btn-success me-2" (click)="onSaveChanges()" type="button">Save Changes</button>
            <button routerLink="../../" class="btn btn-danger" type="button">Cancel</button>
        </div>

        <!-- end table responsive -->
    </div>
</div>